---
layout: post
title: "Deriving Simple Recurrence Formulas for Mean and Variance"
date: 2025-10-30 10:00:00 +0100
categories: statistics homework
---

# Deriving Simple Recurrence Formulas for Mean and Variance

When processing data streams or large datasets, recalculating the mean and variance from scratch for every new observation ($X_n$) is computationally inefficient [1]. Instead, we can use **recurrence (or online) formulas** that update the statistics based only on the previous statistics (for $n-1$ observations) and the new observation [1]. This approach simplifies the process considerably and is often essential in real-time applications [1].

## 1. Recursive Formula for the Mean ($\bar{X}_n$)

The mean of $n$ observations ($\bar{X}_n$) is defined as:
<br>
<code>Mean(n) = (1/n) * Σ [Xᵢ]</code>
<br>
(Dove Σ indica la sommatoria da i=1 a n) [2].

We can separate the sum into the first $n-1$ elements and the $n$-th element ($X_n$) [2]:
<br>
<code>Mean(n) = (1/n) * [ Σ (i=1 to n-1) Xᵢ + Xₙ ]</code>
<br>

We know that the sum of the first $n-1$ elements is equal to $(n-1)$ times the previous mean ($\bar{X}_{n-1}$) [2]:
<br>
<code>Σ (i=1 to n-1) Xᵢ = (n-1) * Mean(n-1)</code>
<br>

Substituting this back into the formula for $\bar{X}_n$ [2]:
<br>
<code>Mean(n) = (1/n) * [ (n-1) * Mean(n-1) + Xₙ ]</code>
<br>

To simplify, we can rewrite $(n-1)/n$ as $1 - 1/n$ [3]:
<br>
<code>Mean(n) = (1 - 1/n) * Mean(n-1) + (1/n) * Xₙ</code>
<br>

Alternatively, a very simple and numerically stable recursive update can be derived by calculating the difference (or error) caused by the new observation [3]:
<br>
<code>Mean(n) = Mean(n-1) + [ Xₙ - Mean(n-1) ] / n</code>
<br>
**This final formula is the simplest recurrence relation for the mean** [3]. The term $ (X_n - \bar{X}_{n-1}) $ is the error, which is then corrected by distributing it across all $n$ observations [3].

## 2. Recursive Formula for the Variance ($V_n$)

The variance is typically calculated using the sum of squared differences from the mean [4]. Let $S_n$ be the sum of squared differences for $n$ observations:
<br>
<code>Sₙ = Σ [ (Xᵢ - Mean(n))² ]</code>
<br>
(Dove Σ indica la sommatoria da i=1 a n) [4].

For recursive calculation, we focus on how $S_n$ relates to $S_{n-1}$ and the new data point $X_n$. This derivation often follows **Welford’s method** to maintain numerical stability [4].

Let $S_{n-1}$ be the previous sum of squared differences. The new sum $S_n$ can be related to $S_{n-1}$ using the following update, which incorporates the previous mean ($\bar{X}_{n-1}$) and the new mean ($\bar{X}_n$) [4, 5]:
<br>
<code>Sₙ = S(n-1) + (Xₙ - Mean(n-1)) * (Xₙ - Mean(n))</code>
<br>

While the term $(X_n - \bar{X}_n)$ can be complex to calculate recursively, we substitute the mean update formula ($\bar{X}_n = \bar{X}_{n-1} + \delta_n / n$, where $\delta_n = X_n - \bar{X}_{n-1}$ is the error) [5]:
<br>
<code>Sₙ = S(n-1) + δₙ * [ δₙ - (δₙ / n) ]</code>
<br>

Simplifying this leads to the **recurrence formula for the sum of squared differences** [5]:
<br>
<code>Sₙ = S(n-1) + [ (n-1)/n ] * (Xₙ - Mean(n-1))²</code>
<br>

Once $S_n$ is calculated, the sample variance $V_n$ is obtained by dividing by $n-1$ (for $n>1$) [5, 6]:
<br>
<code>Vₙ = Sₙ / (n-1)</code>
<br>

## 3. Example Code Implementation

The following Python code demonstrates the use of these recurrence formulas to calculate the mean and variance sequentially as new data arrives [6]. This implements a stable, single-pass algorithm often used in data streaming environments [6].

```python
import random

def calculate_online_statistics(data_stream):
    """
    Calculates the mean and variance recursively (online method).
    Uses the formulas derived above for computational efficiency.
    """
    n = 0 
    mean = 0.0 
    M2 = 0.0 # M2 is the sum of squares of differences (S_n) [6]

    for x in data_stream: 
        n += 1 
        if n == 1: 
            mean = x 
            M2 = 0.0 
        else: 
            # 1. Update Mean (Recurrence Formula: Mean(n) = Mean(n-1) + [ Xₙ - Mean(n-1) ] / n) [7]
            delta = x - mean 
            mean += delta / n 
            
            # 2. Update Sum of Squared Differences (Recurrence Formula for S_n) [7]
            # This is the Welford update optimized for stability:
            delta2 = x - mean 
            M2 += delta * delta2 
    
    variance = M2 / (n - 1) if n > 1 else 0.0 
    return mean, variance, n
    
# Example usage with random data
data = [random.randint(1, 100) for _ in range(10)]
final_mean, final_variance, total_count = calculate_online_statistics(data) [7]

print(f"Data Stream: {data}") [8]
print(f"Total Observations (n): {total_count}") [8]
print(f"Online Mean: {final_mean:.4f}") [8]
print(f"Online Variance: {final_variance:.4f}") [8]

# Compare with built-in functions (using numpy for comparison only) [8]
try: 
    import numpy as np 
    np_mean = np.mean(data) 
    np_variance = np.var(data, ddof=1) # ddof=1 for sample variance [8]
    print("\n--- Verification (Numpy) ---") [8]
    print(f"Numpy Mean: {np_mean:.4f}") [8]
    print(f"Numpy Sample Variance: {np_variance:.4f}") [8]
except ImportError: 
    pass